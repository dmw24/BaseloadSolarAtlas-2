<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baseload Solar Atlas</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        surface: '#1e1e1e',
                        'surface-variant': '#2d2d2d',
                        primary: '#a8c7fa',
                        'on-surface': '#e3e3e3',
                        outline: '#8e918f',
                    }
                }
            }
        }
    </script>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../deployment/css/style.css">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
        rel="stylesheet" />
</head>

<body
    class="bg-black text-on-surface font-sans h-screen w-screen overflow-hidden relative selection:bg-primary selection:text-black">

    <!-- Map Layer (Full Screen) -->
    <div id="map" class="absolute inset-0 z-0 bg-[#0a0a0a]"></div>

    <!-- Top Bar (Floating) -->
    <header class="absolute top-4 left-4 right-4 z-20 flex items-center justify-between pointer-events-none">
        <!-- Search/Brand Area -->
        <div
            class="pointer-events-auto bg-surface/90 backdrop-blur-md border border-white/10 rounded-full shadow-lg flex items-center p-1 pr-4 gap-3 h-12">
            <div
                class="w-10 h-10 rounded-full bg-gradient-to-br from-amber-400 to-orange-600 flex items-center justify-center shadow-inner">
                <span class="material-symbols-outlined text-white text-[20px]">solar_power</span>
            </div>
            <h1 class="font-medium text-lg tracking-tight text-white hidden sm:block">Baseload Solar Atlas</h1>
        </div>

        <!-- View Mode Tabs (Center) -->
        <div
            class="pointer-events-auto bg-surface/90 backdrop-blur-md border border-white/10 rounded-full shadow-lg p-1 flex gap-1 absolute left-1/2 -translate-x-1/2">
            <button data-mode="capacity"
                class="view-tab px-4 py-1.5 rounded-full text-sm font-medium transition-colors bg-primary text-black">
                Capacity Factor Map
            </button>
            <button data-mode="samples"
                class="view-tab px-4 py-1.5 rounded-full text-sm font-medium transition-colors text-gray-400 hover:text-white hover:bg-white/5">
                Sample Weeks
            </button>
            <button data-mode="lcoe"
                class="view-tab px-4 py-1.5 rounded-full text-sm font-medium transition-colors text-gray-400 hover:text-white hover:bg-white/5">
                LCOE Map
            </button>
            <button data-mode="population"
                class="view-tab px-4 py-1.5 rounded-full text-sm font-medium transition-colors text-gray-400 hover:text-white hover:bg-white/5">
                Supply-Demand Matching
            </button>
        </div>

        <!-- Right Actions -->
        <div class="pointer-events-auto flex gap-2">
            <button id="info-toggle"
                class="bg-surface/90 backdrop-blur-md border border-white/10 rounded-full w-12 h-12 flex items-center justify-center shadow-lg text-gray-300 hover:text-white hover:bg-surface-variant transition-colors"
                title="Info">
                <span class="material-symbols-outlined">info</span>
            </button>
        </div>
    </header>

    <!-- Main Floating Panel (Left) -->
    <div class="absolute top-20 left-4 z-20 w-80 flex flex-col gap-3 pointer-events-none">

        <!-- Primary Controls Card -->
        <div id="primary-controls"
            class="pointer-events-auto bg-surface/90 backdrop-blur-md border border-white/10 rounded-2xl shadow-xl p-5 space-y-5 transition-all duration-300">
            <!-- Header -->
            <div class="flex items-center justify-between">
                <h2 class="text-sm font-medium text-gray-400 uppercase tracking-wider">System Config</h2>
                <button id="collapse-controls" class="text-gray-500 hover:text-white transition-colors">
                    <span class="material-symbols-outlined text-[20px]">expand_less</span>
                </button>
            </div>

            <div id="controls-content" class="space-y-5">
                <!-- Solar Slider -->
                <div class="space-y-3">
                    <div class="flex justify-between items-end">
                        <label class="text-sm text-gray-300 font-medium">Solar Capacity</label>
                        <span class="text-2xl font-light text-amber-400"><span id="solar-val">5</span><span
                                class="text-sm text-gray-500 ml-1">GW_DC</span></span>
                    </div>
                    <input type="range" id="solar-slider" min="1" max="20" step="1" value="5"
                        class="w-full h-1.5 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-amber-500 hover:accent-amber-400 transition-all">
                </div>

                <!-- Battery Slider -->
                <div class="space-y-3">
                    <div class="flex justify-between items-end">
                        <label class="text-sm text-gray-300 font-medium">Battery Storage</label>
                        <span class="text-2xl font-light text-cyan-400"><span id="batt-val">8</span><span
                                class="text-sm text-gray-500 ml-1">GWh</span></span>
                    </div>
                    <input type="range" id="batt-slider" min="0" max="36" step="2" value="8"
                        class="w-full h-1.5 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-cyan-500 hover:accent-cyan-400 transition-all">
                </div>

                <!-- Quick Stats (Mini) -->
                <div class="pt-4 border-t border-white/10 grid grid-cols-2 gap-4">
                    <div>
                        <div class="text-[10px] text-gray-500 uppercase tracking-wide">Avg CF</div>
                        <div class="text-lg font-medium text-white" id="stat-avg-cf">--%</div>
                    </div>
                    <div>
                        <div class="text-[10px] text-gray-500 uppercase tracking-wide">Best CF</div>
                        <div class="text-lg font-medium text-emerald-400" id="stat-max-cf">--%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- LCOE Controls (Only visible in LCOE mode) -->
        <div id="lcoe-controls"
            class="hidden pointer-events-auto bg-surface/90 backdrop-blur-md border border-white/10 rounded-2xl shadow-xl p-5 space-y-5">
            <div class="flex items-center justify-between">
                <h2 class="text-sm font-medium text-gray-400 uppercase tracking-wider">LCOE Parameters</h2>
            </div>

            <div class="space-y-4">
                <!-- Target CF Slider -->
                <div class="space-y-2">
                    <label class="text-xs text-gray-400 uppercase">Target Capacity Factor</label>
                    <div class="flex items-center gap-3">
                        <input type="range" id="target-cf-slider" min="50" max="100" step="1" value="90"
                            class="flex-1 h-1.5 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-emerald-500">
                        <span class="text-sm font-mono text-emerald-400 w-12 text-right"><span
                                id="target-cf-val">90</span>%</span>
                    </div>
                </div>

                <!-- LCOE Params Grid -->
                <div class="grid grid-cols-2 gap-3">
                    <label class="space-y-1">
                        <span class="text-[10px] text-gray-500 uppercase">Solar Capex ($/kW)</span>
                        <input id="solar-capex" type="number" value="600"
                            class="w-full bg-surface-variant border border-white/10 rounded px-2 py-1.5 text-xs text-white">
                    </label>
                    <label class="space-y-1">
                        <span class="text-[10px] text-gray-500 uppercase">Battery Capex ($/kWh)</span>
                        <input id="battery-capex" type="number" value="120"
                            class="w-full bg-surface-variant border border-white/10 rounded px-2 py-1.5 text-xs text-white">
                    </label>
                    <label class="space-y-1">
                        <span class="text-[10px] text-gray-500 uppercase">Solar Opex (%)</span>
                        <input id="solar-opex" type="number" value="1.5" step="0.1"
                            class="w-full bg-surface-variant border border-white/10 rounded px-2 py-1.5 text-xs text-white">
                    </label>
                    <label class="space-y-1">
                        <span class="text-[10px] text-gray-500 uppercase">Battery Opex (%)</span>
                        <input id="battery-opex" type="number" value="2.0" step="0.1"
                            class="w-full bg-surface-variant border border-white/10 rounded px-2 py-1.5 text-xs text-white">
                    </label>
                    <label class="space-y-1">
                        <span class="text-[10px] text-gray-500 uppercase">Solar Life (yrs)</span>
                        <input id="solar-life" type="number" value="30"
                            class="w-full bg-surface-variant border border-white/10 rounded px-2 py-1.5 text-xs text-white">
                    </label>
                    <label class="space-y-1">
                        <span class="text-[10px] text-gray-500 uppercase">Battery Life (yrs)</span>
                        <input id="battery-life" type="number" value="20"
                            class="w-full bg-surface-variant border border-white/10 rounded px-2 py-1.5 text-xs text-white">
                    </label>
                    <label class="space-y-1 col-span-2">
                        <span class="text-[10px] text-gray-500 uppercase">WACC (%)</span>
                        <input id="wacc" type="number" value="7.0" step="0.1"
                            class="w-full bg-surface-variant border border-white/10 rounded px-2 py-1.5 text-xs text-white">
                    </label>
                </div>

                <!-- Footer Note -->
                <p class="text-[10px] text-gray-600">Default sources: NREL, Ember, IEA</p>
            </div>
        </div>

        <!-- Sample Controls (Only visible in Samples mode) -->
        <div id="sample-controls"
            class="hidden pointer-events-auto bg-surface/90 backdrop-blur-md border border-white/10 rounded-2xl shadow-xl p-5 space-y-4">
            <div class="space-y-2">
                <label class="text-xs font-medium text-gray-400 uppercase tracking-wider">Select Week</label>
                <select id="sample-week-select"
                    class="w-full bg-surface-variant border border-white/10 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-primary/50">
                    <option>Loading...</option>
                </select>
            </div>

            <div class="space-y-3">
                <div class="flex justify-between text-xs">
                    <span class="text-gray-400 uppercase tracking-wider">Time Scrubber</span>
                    <span id="scrubber-progress" class="text-gray-500 font-mono">Hour 0 / 168</span>
                </div>
                <input type="range" id="time-scrubber" min="0" max="167" value="0"
                    class="w-full h-1.5 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-primary hover:accent-blue-400 transition-all" />
                <div class="text-center text-sm font-mono text-primary" id="scrubber-time">--</div>
            </div>

            <div class="flex gap-2">
                <button id="sample-play"
                    class="flex-1 py-2 bg-primary text-black rounded-lg font-medium text-sm hover:bg-blue-300 transition-colors">
                    Play
                </button>
                <button id="sample-reset"
                    class="px-4 py-2 bg-surface-variant text-gray-300 rounded-lg font-medium text-sm hover:bg-gray-600 transition-colors">
                    Reset
                </button>
            </div>
        </div>

        <!-- Population Controls (Only visible in Population mode) -->
        <div id="population-controls"
            class="hidden pointer-events-auto bg-surface/90 backdrop-blur-md border border-white/10 rounded-2xl shadow-xl p-5 space-y-4">
            <!-- Population specific controls here - simplified for now -->
            <div class="space-y-3">
                <label class="text-xs font-medium text-gray-400 uppercase tracking-wider">Demand Layer</label>
                <div id="population-base-toggle" class="grid grid-cols-2 bg-surface-variant rounded-lg p-1">
                    <button data-base="population"
                        class="px-3 py-1.5 rounded-md text-xs font-medium bg-gray-600 text-white shadow-sm">Population</button>
                    <button data-base="plants"
                        class="px-3 py-1.5 rounded-md text-xs font-medium text-gray-400 hover:text-white">Fossil
                        Plants</button>
                </div>
            </div>

            <div class="space-y-3">
                <label class="text-xs font-medium text-gray-400 uppercase tracking-wider">Supply Layer</label>
                <div id="population-overlay-mode" class="grid grid-cols-3 bg-surface-variant rounded-lg p-1">
                    <button data-overlay="none"
                        class="px-2 py-1.5 rounded-md text-xs font-medium bg-gray-600 text-white shadow-sm">None</button>
                    <button data-overlay="cf"
                        class="px-2 py-1.5 rounded-md text-xs font-medium text-gray-400 hover:text-white">CF</button>
                    <button data-overlay="lcoe"
                        class="px-2 py-1.5 rounded-md text-xs font-medium text-gray-400 hover:text-white">LCOE</button>
                </div>
            </div>

            <!-- CF Overlay Controls (Shown when CF overlay selected) -->
            <div id="population-cf-controls" class="hidden space-y-4 pt-4 border-t border-white/10">
                <h3 class="text-xs font-medium text-gray-400 uppercase tracking-wider">CF Parameters</h3>

                <!-- Solar Slider -->
                <div class="space-y-2">
                    <div class="flex justify-between items-end">
                        <label class="text-xs text-gray-300">Solar Capacity</label>
                        <span class="text-lg font-light text-amber-400"><span id="pop-solar-val">5</span><span
                                class="text-xs text-gray-500 ml-1">GW_DC</span></span>
                    </div>
                    <input type="range" id="pop-solar-slider" min="1" max="20" step="1" value="5"
                        class="w-full h-1.5 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-amber-500">
                </div>

                <!-- Battery Slider -->
                <div class="space-y-2">
                    <div class="flex justify-between items-end">
                        <label class="text-xs text-gray-300">Battery Storage</label>
                        <span class="text-lg font-light text-cyan-400"><span id="pop-batt-val">8</span><span
                                class="text-xs text-gray-500 ml-1">GWh</span></span>
                    </div>
                    <input type="range" id="pop-batt-slider" min="0" max="36" step="2" value="8"
                        class="w-full h-1.5 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-cyan-500">
                </div>
            </div>

            <!-- LCOE Overlay Controls (Shown when LCOE overlay selected) -->
            <div id="population-lcoe-controls" class="hidden space-y-4 pt-4 border-t border-white/10">
                <h3 class="text-xs font-medium text-gray-400 uppercase tracking-wider">LCOE Parameters</h3>

                <!-- Target CF -->
                <div class="space-y-2">
                    <label class="text-xs text-gray-400 uppercase">Target Capacity Factor</label>
                    <div class="flex items-center gap-3">
                        <input type="range" id="pop-target-cf-slider" min="50" max="100" step="1" value="90"
                            class="flex-1 h-1.5 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-emerald-500">
                        <span class="text-sm font-mono text-emerald-400 w-12 text-right"><span
                                id="pop-target-cf-val">90</span>%</span>
                    </div>
                </div>

                <!-- All LCOE Params -->
                <div class="grid grid-cols-2 gap-2">
                    <label class="space-y-1">
                        <span class="text-[10px] text-gray-500 uppercase">Solar Capex ($/kW)</span>
                        <input id="pop-solar-capex" type="number" value="600"
                            class="w-full bg-surface-variant border border-white/10 rounded px-2 py-1 text-xs text-white">
                    </label>
                    <label class="space-y-1">
                        <span class="text-[10px] text-gray-500 uppercase">Battery Capex ($/kWh)</span>
                        <input id="pop-battery-capex" type="number" value="120"
                            class="w-full bg-surface-variant border border-white/10 rounded px-2 py-1 text-xs text-white">
                    </label>
                    <label class="space-y-1">
                        <span class="text-[10px] text-gray-500 uppercase">Solar Opex (%)</span>
                        <input id="pop-solar-opex" type="number" value="1.5" step="0.1"
                            class="w-full bg-surface-variant border border-white/10 rounded px-2 py-1 text-xs text-white">
                    </label>
                    <label class="space-y-1">
                        <span class="text-[10px] text-gray-500 uppercase">Battery Opex (%)</span>
                        <input id="pop-battery-opex" type="number" value="2.0" step="0.1"
                            class="w-full bg-surface-variant border border-white/10 rounded px-2 py-1 text-xs text-white">
                    </label>
                    <label class="space-y-1">
                        <span class="text-[10px] text-gray-500 uppercase">Solar Life (yrs)</span>
                        <input id="pop-solar-life" type="number" value="30"
                            class="w-full bg-surface-variant border border-white/10 rounded px-2 py-1 text-xs text-white">
                    </label>
                    <label class="space-y-1">
                        <span class="text-[10px] text-gray-500 uppercase">Battery Life (yrs)</span>
                        <input id="pop-battery-life" type="number" value="20"
                            class="w-full bg-surface-variant border border-white/10 rounded px-2 py-1 text-xs text-white">
                    </label>
                    <label class="space-y-1 col-span-2">
                        <span class="text-[10px] text-gray-500 uppercase">WACC (%)</span>
                        <input id="pop-wacc" type="number" value="7.0" step="0.1"
                            class="w-full bg-surface-variant border border-white/10 rounded px-2 py-1 text-xs text-white">
                    </label>
                </div>
            </div>

            <div class="space-y-3">
                <label class="text-xs font-medium text-gray-400 uppercase tracking-wider">View</label>
                <div id="population-display-toggle" class="grid grid-cols-2 bg-surface-variant rounded-lg p-1">
                    <button data-mode="map"
                        class="px-3 py-1.5 rounded-md text-xs font-medium bg-gray-600 text-white shadow-sm">Map</button>
                    <button data-mode="charts"
                        class="px-3 py-1.5 rounded-md text-xs font-medium text-gray-400 hover:text-white">Charts</button>
                </div>
            </div>
        </div>

    </div>

    <!-- Right Bottom Legends (Floating) -->
    <div class="absolute bottom-8 right-4 z-20 flex flex-col items-end gap-3 pointer-events-none">

        <!-- Capacity Legend -->
        <div id="legend-capacity"
            class="pointer-events-auto bg-surface/90 backdrop-blur-md border border-white/10 rounded-xl shadow-xl p-4 w-64">
            <div class="text-xs font-medium text-gray-400 uppercase tracking-wider mb-2">Capacity Factor</div>
            <div class="w-full h-2 rounded-full mb-2 legend-gradient"></div>
            <div class="flex justify-between text-[10px] font-mono text-gray-500">
                <span>5%</span>
                <span>40%</span>
                <span>70%</span>
                <span>100%</span>
            </div>
        </div>

        <!-- LCOE Legend -->
        <div id="legend-lcoe"
            class="hidden pointer-events-auto bg-surface/90 backdrop-blur-md border border-white/10 rounded-xl shadow-xl p-4 w-64">
            <div id="legend-lcoe-title" class="text-xs font-medium text-gray-400 uppercase tracking-wider mb-2">LCOE
                ($/MWh)</div>
            <div class="w-full h-2 rounded-full mb-2 legend-gradient-cost" id="legend-lcoe-bar"></div>
            <div class="flex justify-between text-[10px] font-mono text-gray-500 mb-2">
                <span id="legend-lcoe-min">--</span>
                <span id="legend-lcoe-mid">--</span>
                <span id="legend-lcoe-max">--</span>
            </div>
            <div class="text-[10px] text-gray-400" id="legend-lcoe-ref">Reference: --</div>
            <div id="comparison-toggle" class="hidden mt-2 pt-2 border-t border-white/10">
                <div class="space-y-2">
                    <div class="text-[10px] text-gray-400 uppercase tracking-wider mb-1">Display Mode</div>
                    <div id="lcoe-display-mode" class="grid grid-cols-2 bg-surface-variant rounded-lg p-1">
                        <button data-mode="delta"
                            class="px-2 py-1 rounded-md text-[10px] font-medium bg-gray-600 text-white shadow-sm">LCOE
                            Î”</button>
                        <button data-mode="transmission"
                            class="px-2 py-1 rounded-md text-[10px] font-medium text-gray-400 hover:text-white">TX
                            Cost</button>
                    </div>
                    <button id="lcoe-clear-ref"
                        class="w-full text-[10px] px-2 py-1 bg-surface-variant rounded text-gray-300 hover:text-white transition-colors">Clear
                        Reference</button>
                </div>
            </div>
        </div>

        <!-- Population Legend -->
        <div id="legend-population"
            class="hidden pointer-events-auto bg-surface/90 backdrop-blur-md border border-white/10 rounded-xl shadow-xl p-4 w-64">
            <div class="text-xs font-medium text-gray-400 uppercase tracking-wider mb-2">Population</div>
            <div class="w-full h-2 rounded-full mb-2 legend-gradient-pop"></div>
            <div class="flex justify-between text-[10px] font-mono text-gray-500">
                <span id="legend-pop-min">0</span>
                <span id="legend-pop-max">--</span>
            </div>
        </div>

    </div>


    <!-- Info Modal (Hidden by default) -->
    <div id="info-panel" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" id="info-backdrop"></div>
        <div
            class="relative bg-surface border border-white/10 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[80vh] overflow-y-auto p-8 space-y-6">
            <div class="flex justify-between items-start">
                <div>
                    <h2 class="text-2xl font-semibold text-white">Baseload Solar Atlas</h2>
                    <p class="text-gray-400 mt-1">Understanding the metrics and models.</p>
                </div>
                <button id="info-close" class="text-gray-400 hover:text-white">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>

            <div class="space-y-4 text-sm text-gray-300 leading-relaxed">
                <p>
                    <strong class="text-primary">The Goal:</strong> Can solar + battery storage alone provide a constant
                    "baseload" power supply 24/7/365?
                </p>
                <p>
                    This tool simulates a 1 GW constant load at thousands of locations worldwide. It calculates how much
                    solar capacity (GW_DC) and battery storage (GWh) is needed to meet that load, and what the resulting
                    Capacity Factor (reliability) and LCOE (cost) would be.
                </p>

                <h3 class="text-white font-medium pt-2">Key Metrics</h3>
                <ul class="list-disc pl-5 space-y-1">
                    <li><strong class="text-white">Capacity Factor (CF):</strong> The percentage of hours in a year that
                        the system successfully meets the 1 GW demand.</li>
                    <li><strong class="text-white">LCOE:</strong> Levelized Cost of Energy. The average cost per MWh of
                        electricity produced, factoring in CAPEX, OPEX, and financing.</li>
                </ul>

                <h3 class="text-white font-medium pt-2">Credits</h3>
                <p class="text-xs text-gray-500">
                    Created by Daan Walter, 2025. Data sources: NASA POWER (Solar/Weather), NASA SEDAC (Population).
                </p>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading" class="absolute inset-0 bg-black z-50 flex items-center justify-center">
        <div class="text-center space-y-4">
            <div class="w-12 h-12 border-4 border-surface-variant border-t-primary rounded-full animate-spin mx-auto">
            </div>
            <div class="text-gray-300 font-medium">Initializing Atlas...</div>
            <div class="text-xs text-gray-500" id="loading-status">Loading assets...</div>
        </div>
    </div>

    <!-- Population Charts Overlay (Full Screen-ish) -->
    <div id="population-charts"
        class="hidden absolute inset-0 z-10 bg-black/95 overflow-y-auto pt-24 pb-10 px-4 sm:px-10">
        <div class="max-w-6xl mx-auto space-y-6">
            <div class="flex justify-between items-center">
                <h2 class="text-xl font-semibold text-white">Population Analysis</h2>
                <button id="close-charts" class="text-primary hover:text-white text-sm font-medium">Back to Map</button>
            </div>

            <!-- Percentile Chart - Full Width -->
            <div class="bg-surface border border-white/10 rounded-xl p-6">
                <h3 class="text-sm font-medium text-gray-400 mb-4">Metric by Population Percentile</h3>
                <div class="h-64"><canvas id="population-chart-histogram"></canvas></div>
            </div>

            <!-- Latitude Charts - Side by Side -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-surface border border-white/10 rounded-xl p-6">
                    <h3 class="text-sm font-medium text-gray-400 mb-4">Metric by Latitude</h3>
                    <div class="h-64"><canvas id="population-chart-lat-metric"></canvas></div>
                </div>
                <div class="bg-surface border border-white/10 rounded-xl p-6">
                    <h3 class="text-sm font-medium text-gray-400 mb-4">Population Distribution</h3>
                    <div class="h-64"><canvas id="population-chart-lat-pop"></canvas></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sample Chart Overlay (Bottom Sheet) -->
    <div id="sample-chart-overlay"
        class="hidden absolute bottom-0 left-0 right-0 z-30 bg-surface border-t border-white/10 rounded-t-2xl shadow-2xl p-6 transform transition-transform duration-300">
        <div class="flex justify-between items-center mb-4">
            <div>
                <h3 class="text-sm font-medium text-white">Sample Week Analysis</h3>
                <div class="text-xs text-gray-400" id="sample-chart-location">Select a location...</div>
            </div>
            <button id="sample-chart-close" class="text-gray-400 hover:text-white"><span
                    class="material-symbols-outlined">close</span></button>
        </div>
        <div class="h-48 w-full">
            <canvas id="sample-chart-canvas"></canvas>
        </div>
    </div>

    <!-- Libraries -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Application Logic -->
    <script type="module" src="../deployment/js/app.js"></script>

    <!-- Inline UI Logic for Modals/Tabs -->
    <script>
        // Simple UI logic that doesn't depend on the main app
        document.addEventListener('DOMContentLoaded', () => {
            // Info Modal
            const infoPanel = document.getElementById('info-panel');
            const infoToggle = document.getElementById('info-toggle');
            const infoClose = document.getElementById('info-close');
            const infoBackdrop = document.getElementById('info-backdrop');

            const toggleInfo = (show) => {
                infoPanel.classList.toggle('hidden', !show);
            };

            infoToggle?.addEventListener('click', () => toggleInfo(true));
            infoClose?.addEventListener('click', () => toggleInfo(false));
            infoBackdrop?.addEventListener('click', () => toggleInfo(false));

            // Collapse Controls
            const collapseBtn = document.getElementById('collapse-controls');
            const controlsContent = document.getElementById('controls-content');
            let isCollapsed = false;

            collapseBtn?.addEventListener('click', () => {
                isCollapsed = !isCollapsed;
                controlsContent.classList.toggle('hidden', isCollapsed);
                collapseBtn.querySelector('span').textContent = isCollapsed ? 'expand_more' : 'expand_less';
            });
        });
    </script>
</body>

</html>